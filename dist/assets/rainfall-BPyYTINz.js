import{l as L,b as V,a as X,m as z,c as F,f as Q}from"./datasets-index-DCIs3d3F.js";function Z(){let b=[{temp:0,rain:1,temp1:0,rain1:1,temp2:1,rain2:1.2,temp3:-1,rain3:.8},{temp:10,rain:2,temp1:10,rain1:2,temp2:11,rain2:2.3,temp3:9,rain3:1.7},{temp:20,rain:4,temp1:20,rain1:4,temp2:22,rain2:4.5,temp3:18,rain3:3.5},{temp:25,rain:5,temp1:25,rain1:5,temp2:27,rain2:5.5,temp3:23,rain3:4.5},{temp:30,rain:6,temp1:30,rain1:6,temp2:32,rain2:6.5,temp3:28,rain3:5.5}],s=.1,m=.1,h=0,E=0,f=[{iteration:0,error:0}],i=1,B=null;const g=500,p=300,n={top:12,bottom:18,left:40,right:30},v=L().range([n.left,g-n.right]),k=L().range([p-n.bottom,n.top]),$=L().range([n.left,g-n.right]),w=L().range([p-n.bottom,n.top]),K=V().x(t=>v(t.temp)).y(t=>k(t.y)),N=V().x(t=>$(t.iteration)).y(t=>w(t.error)),y=X("#scatter-chart").selectAll("svg").data([null]).join("svg").attr("width",g).attr("height",p+n.top+n.bottom),_=X("#error-chart").selectAll("svg").data([null]).join("svg").attr("width",g).attr("height",p+n.top+n.bottom);function C(t,a,l,c,u){t.selectAll(".grid-line").remove(),t.selectAll(".axis-line").remove(),t.selectAll(".axis-text").remove(),t.selectAll(".axis-label").remove(),t.selectAll(".x-tick").data(a.ticks()).enter().append("g").attr("transform",d=>`translate(${a(d)}, ${p-n.bottom})`).append("line").attr("class","grid-line").attr("y2",-300+n.bottom+n.top),t.selectAll(".y-tick").data(l.ticks()).enter().append("g").attr("transform",d=>`translate(${n.left}, ${l(d)})`).append("line").attr("class","grid-line").attr("x2",g-n.left-n.right),t.append("line").attr("class","axis-line").attr("x1",n.left).attr("x2",g-n.right).attr("y1",p-n.bottom).attr("y2",p-n.bottom),t.append("line").attr("class","axis-line").attr("x1",n.left).attr("x2",n.left).attr("y1",p-n.bottom).attr("y2",n.top),t.append("text").attr("class","axis-label").attr("x",(g+n.left)/2).attr("y",p+n.bottom-5).attr("text-anchor","middle").text(c),t.append("text").attr("class","axis-label").attr("x",-300/2).attr("y",n.left/4.8).attr("text-anchor","middle").attr("transform","rotate(-90)").text(u)}function x(t){const a=document.getElementById("feedback");a?(a.innerHTML=`<p class="feedback">${t}</p>`,setTimeout(()=>a.innerHTML="",2e3)):console.warn("Feedback element not found")}function I(){if(!y.node()||!_.node()){console.error("SVG elements not found for scatter or error chart");return}const t=b.map(e=>{const o=e[`temp${i}`]!==void 0?e[`temp${i}`]:e.temp,A=e[`rain${i}`]!==void 0?e[`rain${i}`]:e.rain;return{temp:o,y:s+m*o,rain:A}}),a=t.map(e=>(e.rain-(m*e.temp+s))**2);E=a.reduce((e,o)=>e+o,0)/a.length,f.push({iteration:h,error:E}),v.domain([z(t,e=>e.temp)-5,F(t,e=>e.temp)+5]),k.domain([z(t,e=>e.rain)-2,F(t,e=>e.rain)+2]),C(y,v,k,"温度 (摄氏度)","雨量 (毫米)"),y.selectAll(".regression-line").remove(),y.append("path").attr("class","regression-line").attr("d",K(t)),y.selectAll(".regression-circle").data(t).join("circle").attr("class","regression-circle").attr("r",4.5).attr("cx",e=>v(e.temp)).attr("cy",e=>k(e.rain)),$.domain([0,F(f,e=>e.iteration)*1.6]),w.domain([0,E<200?300:E*1.3]),C(_,$,w,"步数","猜错的程度"),_.selectAll(".error-line").remove(),_.append("path").attr("class","error-line").attr("d",N(f)),_.selectAll(".regression-circle").data([f[f.length-1]]).join("circle").attr("class","regression-circle").attr("r",4.5).attr("cx",e=>$(e.iteration)).attr("cy",e=>w(e.error)),_.selectAll(".error-text").data([f[f.length-1]]).join("text").attr("class","error-text").attr("x",e=>$(e.iteration)).attr("y",e=>w(e.error)).text(e=>Q(".3f")(e.error));const l=document.getElementById("bias-value"),c=document.getElementById("weight-value"),u=document.getElementById("bias-slider"),d=document.getElementById("weight-slider"),r=document.getElementById("equation-display");l&&(l.textContent=s.toFixed(3)),c&&(c.textContent=m.toFixed(3)),u&&(u.value=s),d&&(d.value=m),r&&(r.innerHTML=`魔法线公式：雨量 = ${m.toFixed(3)} × 温度 ${s<0?"":"+"}${s.toFixed(3)}`)}function S(t){const a=b.length,l=.001;h+=t;for(let c=0;c<t;c++){let u=b.map(r=>{const e=r[`temp${i}`]!==void 0?r[`temp${i}`]:r.temp,o=r[`rain${i}`]!==void 0?r[`rain${i}`]:r.rain;let A=m*e+s;return e*(o-A)}),d=b.map(r=>{const e=r[`temp${i}`]!==void 0?r[`temp${i}`]:r.temp,o=r[`rain${i}`]!==void 0?r[`rain${i}`]:r.rain;let A=m*e+s;return o-A});m-=l*(-2/a)*u.reduce((r,e)=>r+e,0),s-=l*(-2/a)*d.reduce((r,e)=>r+e,0)}I(),x(`又走了${t}步，猜得更准了！`)}function W(t){var u;const a=(u=y.node())==null?void 0:u.getBoundingClientRect();if(!a){console.error("Scatter SVG not found for adding data point");return}const l=t.clientX-a.left,c=t.clientY-a.top;if(l>=n.left&&l<=g-n.right&&c>=n.top&&c<=p-n.bottom){const d=v.invert(l),r=k.invert(c),e={temp:d,rain:r};for(let o=1;o<=3;o++)e[`temp${o}`]=d,e[`rain${o}`]=r;b.push(e),h++,I(),x("加了一天的雨量，魔法线要重新学啦！")}}function Y(){b=[{temp:0,rain:1,temp1:0,rain1:1,temp2:1,rain2:1.2,temp3:-1,rain3:.8},{temp:10,rain:2,temp1:10,rain1:2,temp2:11,rain2:2.3,temp3:9,rain3:1.7},{temp:20,rain:4,temp1:20,rain1:4,temp2:22,rain2:4.5,temp3:18,rain3:3.5},{temp:25,rain:5,temp1:25,rain1:5,temp2:27,rain2:5.5,temp3:23,rain3:4.5},{temp:30,rain:6,temp1:30,rain1:6,temp2:32,rain2:6.5,temp3:28,rain3:5.5}],s=.1,m=.1,h=0,E=0,f=[{iteration:0,error:0}],i=1,I(),x("一切都重置啦！再来试试吧！")}function J(){const t=document.getElementById("run-auto");if(!t){console.warn("Auto run button not found");return}B?(clearInterval(B),B=null,t.textContent="自动运行",x("暂停啦！可以继续点其他按钮哦！")):(t.textContent="停止运行",B=setInterval(()=>{S(1),(E<.01||h>1e3)&&(clearInterval(B),B=null,t.textContent="自动运行",x("宝藏找到啦！魔法线超级准了！"))},500))}function O(){try{katex.render("\\begin{aligned} \\hat{y}=\\hat{\\beta_0} + \\hat{\\beta_1}x \\end{aligned}",document.getElementById("math-equation1"),{displayMode:!0}),katex.render("\\begin{aligned} MSE(\\hat{\\beta_0}, \\hat{\\beta_1}) = \\frac{1}{n} \\sum^{n}_{i=1}(y_i - \\hat{y_i})^2 \\\\ = \\frac{1}{n} \\sum^{n}_{i=1}(y_i - (\\hat{\\beta_0} + \\hat{\\beta_1}x ))^2 \\end{aligned}",document.getElementById("math-equation2"),{displayMode:!0}),katex.render("\\frac{\\delta}{\\delta\\beta_i}MSE = \\begin{cases} -\\frac{2}{n} \\sum^{n}_{i=1}(y_i - \\hat{y_i}) \\text{for i = 0} \\\\ -\\frac{2}{n} \\sum^{n}_{i=1}x_i(y_i - \\hat{y_i}) \\text{for i = 1} \\end{cases}",document.getElementById("math-equation3"),{displayMode:!0}),katex.render("\\text{repeat until converge:} = \\begin{cases} \\beta_0 = \\beta_0 - \\alpha (-\\frac{2}{n} \\sum^{n}_{i=1}(y_i - \\hat{y_i})) \\\\ \\beta_1 = \\beta_1 - \\alpha (-\\frac{2}{n} x_i\\sum^{n}_{i=1}(y_i - \\hat{y_i})) \\end{cases}",document.getElementById("math-equation4"),{displayMode:!0})}catch(t){console.error("Failed to render KaTeX formulas:",t)}}const D=document.getElementById("step-1"),P=document.getElementById("step-25"),q=document.getElementById("step-100"),T=document.getElementById("run-auto"),j=document.getElementById("bias-slider"),R=document.getElementById("weight-slider"),G=document.getElementById("add-point-btn"),H=document.getElementById("reset-btn"),M=document.getElementById("toggle-math");D&&D.addEventListener("click",()=>S(1)),P&&P.addEventListener("click",()=>S(25)),q&&q.addEventListener("click",()=>S(100)),T&&T.addEventListener("click",J),j&&j.addEventListener("input",t=>{s=+t.target.value,h++,I(),x("你调整了基础雨量，魔法线变了！")}),R&&R.addEventListener("input",t=>{m=+t.target.value,h++,I(),x("你调整了温度的影响，魔法线变了！")}),G&&G.addEventListener("click",()=>{var t;(t=y.node())==null||t.addEventListener("click",W,{once:!0})}),H&&H.addEventListener("click",Y),M&&M.addEventListener("click",()=>{const t=document.getElementById("math-section");t?(t.style.display=t.style.display==="block"?"none":"block",M.textContent=t.style.display==="block"?"隐藏数学公式":"显示数学公式"):console.warn("Math section element not found")});try{O(),I()}catch(t){console.error("Failed to initialize rainfall component:",t)}}export{Z as r};
